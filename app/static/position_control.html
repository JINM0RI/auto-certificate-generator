<!DOCTYPE html>
<html>
<head>
  

<style>
#canvas {
  position: relative;
  display: inline-block;
}

#certImage {
  width: 900px;
}

#nameOverlay {
  position: absolute;
  top: 300px;
  left: 300px;
  font-size: 48px;
  font-weight: bold;
  color: red;
  cursor: move;
  user-select: none;
}
</style>
</head>
 <h1 style="color:red;">POSITION EDITOR LOADED</h1>

<body>
 

<div id="canvas">
  <!-- CHANGE cert.png to your uploaded template name -->
  <img id="certImage" src="/uploads/templates/certificate.png">
  <div id="nameOverlay">Test User</div>
</div>

<br><br>
<button onclick="savePosition()">Save Position</button>

<script>
const overlay = document.getElementById("nameOverlay");
let dragging = false;
let offsetX = 0, offsetY = 0;

overlay.onmousedown = e => {
  dragging = true;
  offsetX = e.offsetX;
  offsetY = e.offsetY;
};

document.onmousemove = e => {
  if (!dragging) return;
  overlay.style.left = (e.pageX - offsetX) + "px";
  overlay.style.top  = (e.pageY - offsetY) + "px";
};

document.onmouseup = () => dragging = false;

function savePosition() {
    const x = overlay.offsetLeft;
    const y = overlay.offsetTop;

    fetch("/save-position", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ x, y })
    })
    .then(res => res.json())
    .then(() => {
        alert("Position saved");
        window.close(); // âœ… NOW THIS WILL WORK
    });
}

console.log("Opened by JS:", window.opener !== null);
</script>


</body>
</html>
